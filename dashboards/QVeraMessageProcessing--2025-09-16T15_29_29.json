{"title":"QVera Message Processing","description":"","widgets":[{"id":7321622828038158,"definition":{"title":"Total backlog by channel","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"avg:qie.channel.inbound{environment:prd} by {channel.name,client}","aggregator":"last"},{"data_source":"metrics","name":"query2","query":"avg:qie.channel.outbound{environment:prd} by {channel.name,client}","aggregator":"last"}],"response_format":"scalar","conditional_formats":[{"comparator":"<","value":100,"palette":"white_on_green"},{"comparator":"<","value":500,"palette":"white_on_yellow"},{"comparator":">=","value":500,"palette":"white_on_red"}],"formulas":[{"formula":"query1 + query2"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked"}}},"layout":{"x":0,"y":0,"width":2,"height":2}},{"id":1454060590774443,"definition":{"title":"Total Errors by Channel","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:qie.channel.errors{environment:prd} by {channel.name,client}","aggregator":"last"}],"response_format":"scalar","conditional_formats":[{"comparator":"<","value":1,"palette":"white_on_green"},{"comparator":"<","value":20,"palette":"white_on_yellow"},{"comparator":">=","value":20,"palette":"white_on_red"}],"formulas":[{"formula":"query1"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked"}}},"layout":{"x":2,"y":0,"width":2,"height":2}},{"id":2998384599154328,"definition":{"title":"Top Skipped Facilities","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"logs","search":{"query":"kube_namespace:integration \"message skipped\" client:lbh"},"indexes":["*"],"group_by":[{"facet":"@facility","limit":25,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":25,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"layout":{"x":4,"y":0,"width":2,"height":2}},{"id":5697834707100028,"definition":{"title":"% Processed","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"fraction"}},"formula":"query2 / (query1 + query2)"}],"queries":[{"name":"query2","data_source":"logs","search":{"query":"client:lbh kube_namespace:integration \"message processed\""},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"},{"name":"query1","data_source":"logs","search":{"query":"client:lbh kube_namespace:integration \"message skipped\""},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":0,"width":2,"height":2}},{"id":4736820714701880,"definition":{"title":"Messages Skipped","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"name":"query1","data_source":"logs","search":{"query":"kube_namespace:integration \"message skipped\""},"indexes":["*"],"group_by":[{"facet":"@skipReason","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true},{"facet":"client","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","sort":{"count":100,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"trend","formula":"query1"}]}],"has_search_bar":"auto"},"layout":{"x":8,"y":0,"width":2,"height":2}},{"id":890060742903992,"definition":{"title":"Percent of FHIR queries retried","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"default_zero(query2) / (query1 + default_zero(query2))","number_format":{"unit":{"type":"canonical_unit","unit_name":"fraction"}}}],"queries":[{"name":"query2","data_source":"logs","search":{"query":"service:qie client:lbh \"fhir query\" !@attempts:1"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"},{"name":"query1","data_source":"logs","search":{"query":"service:qie client:lbh \"fhir query\" @attempts:1"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar"}],"autoscale":true,"precision":0,"timeseries_background":{"yaxis":{},"type":"bars"}},"layout":{"x":10,"y":0,"width":2,"height":2}},{"id":5008175831003158,"definition":{"title":"IHC Messages per Minute","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"response_format":"timeseries","queries":[{"name":"query0","data_source":"logs","search":{"query":"kube_namespace:integration (\"message processed\" OR \"message skipped\") @channelName:*IHC*"},"indexes":["*"],"group_by":[{"facet":"@triggerEvent","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"}}],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"alias":"messages","formula":"default_zero(query0)"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":true,"response_format":"timeseries","queries":[{"name":"query1","data_source":"metrics","query":"sum:qie.channel.inbound{client:ihc, environment:prd}"},{"name":"query2","data_source":"metrics","query":"sum:qie.channel.errors{client:ihc, environment:prd}"}],"formulas":[{"style":{"palette":"green","palette_index":2},"alias":"backlog","formula":"default_zero(query1)"},{"style":{"palette":"warm","palette_index":4},"alias":"errors","formula":"default_zero(query2)"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":2,"width":4,"height":3}},{"id":5200841962247190,"definition":{"title":"IHC FHIR Queries per Minute","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query0","data_source":"logs","search":{"query":"kube_namespace:integration @channelName:*IHC* \"fhir query\""},"indexes":["*"],"group_by":[{"facet":"@resourceType","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":60000},"storage":"hot"}],"formulas":[{"alias":"messages","formula":"default_zero(query0)"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"markers":[{"label":" rate-limiter ","value":"y = 200","display_type":"error dashed"}]},"layout":{"x":4,"y":2,"width":4,"height":3}},{"id":4318601380998638,"definition":{"title":"Total Query Time by Resource","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"logs","search":{"query":"kube_namespace:integration client:lbh \"fhir query\""},"indexes":["*"],"group_by":[{"facet":"@resourceType","limit":10,"sort":{"aggregation":"sum","order":"desc","metric":"@timeMs"},"should_exclude_missing":true}],"compute":{"aggregation":"sum","metric":"@timeMs","interval":60000},"storage":"hot"}],"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"millisecond"}},"alias":"total query time","formula":"default_zero(ewma_3(query1))"}],"style":{"palette":"dog_classic","order_by":"values","order_reverse":false,"line_type":"solid","line_width":"normal"},"display_type":"area"}]},"layout":{"x":8,"y":2,"width":4,"height":3}},{"id":8914616626811756,"definition":{"title":"LBH Messages per Minute","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"logs","search":{"query":"kube_namespace:integration \"MESSAGE PROCESSED\" $facility @channelName:\"LBH HL7 over HTTP\""},"indexes":["*"],"group_by":[{"facet":"@triggerEvent","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":60000},"storage":"hot"}],"formulas":[{"formula":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":true,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query0","query":"avg:qie.channel.inbound{channel.name:lbh-hl7-over-http}"},{"data_source":"metrics","name":"query1","query":"avg:qie.channel.errors{channel.name:lbh-hl7-over-http}"}],"formulas":[{"style":{"palette":"green","palette_index":2},"alias":"backlog","formula":"query0"},{"style":{"palette":"warm","palette_index":4},"alias":"errors","formula":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":5,"width":4,"height":3}},{"id":6847235241381506,"definition":{"title":"LBH FHIR Queries per Minute","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"logs","search":{"query":"kube_namespace:integration client:lbh environment:prd \"FHIR QUERY\""},"indexes":["*"],"group_by":[{"facet":"@resourceType","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":60000},"storage":"hot"}],"formulas":[{"formula":"default_zero(query1)"}],"style":{"palette":"dog_classic","order_by":"tags","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"include_zero":true,"max":"auto"},"markers":[{"label":" rate-limiter ","value":"y = 100","display_type":"error dashed"}]},"layout":{"x":4,"y":5,"width":4,"height":3}},{"id":8098949172209744,"definition":{"title":"Average FHIR Query Time","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"logs","search":{"query":"client:lbh service:qie \"fhir query\""},"indexes":["*"],"group_by":[{"facet":"@resourceType","limit":10,"sort":{"aggregation":"pc95","order":"desc","metric":"@timeMs"},"should_exclude_missing":true}],"compute":{"aggregation":"pc95","metric":"@timeMs","interval":60000},"storage":"hot"}],"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"millisecond"}},"formula":"ewma_3(default_zero(query1))"}],"style":{"palette":"dog_classic","order_by":"tags","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":8,"y":5,"width":4,"height":3}},{"id":661056547617323,"definition":{"title":"Messages / minute Received","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"metrics","query":"avg:qie.channel.received{environment:prd} by {channel.name}"}],"formulas":[{"formula":"per_minute(query1)"}],"style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}],"anomaly_detection":{"detection_sensitivity":"never_detect"}},"layout":{"x":0,"y":8,"width":4,"height":3}},{"id":2300010161391318,"definition":{"title":"Messages / minute Completed","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"metrics","query":"avg:qie.channel.completed{environment:prd} by {channel.name}"}],"formulas":[{"formula":"per_minute(query1)"}],"style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}],"anomaly_detection":{"detection_sensitivity":"never_detect"}},"layout":{"x":4,"y":8,"width":4,"height":3}},{"id":4340828975899708,"definition":{"title":"Message Processing Time vs Query Time","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query1","data_source":"logs","search":{"query":"client:lbh service:qie @channelName:\"LBH HL7 over HTTP\""},"indexes":["*"],"group_by":[],"compute":{"aggregation":"avg","metric":"@timeMs"},"storage":"hot"},{"name":"query2","data_source":"logs","search":{"query":"client:lbh service:qie @channelName:\"LBH HL7 over HTTP\""},"indexes":["*"],"group_by":[],"compute":{"aggregation":"avg","metric":"@fhirQueryTimeMs"},"storage":"hot"}],"formulas":[{"alias":"Processing Time","formula":"default_zero(ewma_5(query1))"},{"alias":"Query Time","formula":"default_zero(ewma_5(query2))"}],"style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":8,"y":8,"width":4,"height":3}}],"template_variables":[{"name":"facility","prefix":"@facility","available_values":[],"default":"*"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed","tags":["team:platform-infrastructure-team"]}