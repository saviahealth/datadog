{"title":"Cluster Health Checks","description":"","widgets":[{"id":5366466457329083,"definition":{"title":"Maximum Pulsar Subscription Backlog by Namespace","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:pulsar.subscription_back_log{(namespace:clinical-apps/* OR namespace:inbound/clinical-events) AND NOT topic:*stage* AND $client AND NOT subscription:__* AND NOT subscription:*Reader* AND NOT subscription:*reader* AND NOT subscription:*-DLT AND NOT subscription:*-dlt AND NOT subscription:*_compaction* AND $client} by {namespace,topic,subscription}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear"},"markers":[],"custom_links":[{"label":"/dashboard/vh4-zy3-kcf/pipeline-message-processing?tpl_var_pulsar_namespace={{namespace}}","link":"/dashboard/vh4-zy3-kcf/pipeline-message-processing?tpl_var_pulsar_namespace={{namespace.value}}"}]},"layout":{"x":0,"y":0,"width":6,"height":3}},{"id":5577614553921749,"definition":{"title":"Replication Slot Status","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"name":"query2","data_source":"metrics","query":"min:saviadb.replication_slot.active{slot_type:logical,$client} by {kube_namesapce,slot_name}","aggregator":"last"},{"name":"query1","data_source":"metrics","query":"max:saviadb.replication_slot.backlog_size{slot_type:logical,$client} by {kube_namesapce,slot_name}","aggregator":"last"}],"sort":{"count":500,"order_by":[{"type":"formula","index":1,"order":"desc"}]},"formulas":[{"conditional_formats":[{"comparator":">","value":0,"palette":"white_on_green"},{"comparator":"<","value":1,"palette":"white_on_red"}],"alias":"active","formula":"query2"},{"cell_display_mode":"number","conditional_formats":[{"comparator":">","value":25000000000,"palette":"white_on_red"},{"comparator":">","value":10000000000,"palette":"white_on_yellow"},{"comparator":"<=","value":10000000000,"palette":"white_on_green"}],"number_format":{"unit":{"type":"canonical_unit","unit_name":"byte"}},"alias":"backlog","formula":"query1"}]}],"has_search_bar":"never"},"layout":{"x":6,"y":0,"width":4,"height":5}},{"id":2404552583628504,"definition":{"title":"","type":"manage_status","display_format":"countsAndList","color_preference":"text","hide_zero_counts":true,"show_status":true,"last_triggered_format":"relative","query":"","sort":"status,asc","count":50,"start":0,"summary_type":"monitors","show_priority":false,"show_last_triggered":false},"layout":{"x":10,"y":0,"width":2,"height":9}},{"id":4765553865600885,"definition":{"title":"HL7 Messages Processed / min","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"logs","search":{"query":"$client service:qie (\"message processed\" OR \"message skipped\") environment:prd"},"indexes":["*"],"group_by":[{"facet":"@channelName","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":60000},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":true,"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query0","query":"avg:qie.channel.errors{$client} by {channel.name}"}],"formulas":[{"formula":"query0"}],"style":{"palette":"red","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","max":"auto"}},"layout":{"x":0,"y":3,"width":6,"height":3}},{"id":2464192712502813,"definition":{"title":"Database Used Storage (%)","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"avg:azure.dbforpostgresql_flexibleservers.storage_percent{$client OR NOT client:*} by {database_instance}","aggregator":"avg"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"conditional_formats":[{"comparator":"<","value":75,"palette":"white_on_green"},{"comparator":"<","value":85,"palette":"white_on_yellow"},{"comparator":">=","value":85,"palette":"white_on_red"}],"cell_display_mode":"number","alias":"% Used","formula":"query1"}]}],"has_search_bar":"auto"},"layout":{"x":6,"y":5,"width":4,"height":4}},{"id":6065655452075872,"definition":{"title":"Pulsar Local Storage by Namespace","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1 - query2"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:pulsar.storage_size{!namespace:compliance/*,$client} by {namespace}"},{"name":"query2","data_source":"metrics","query":"sum:pulsar.storage_offloaded_size{!namespace:compliance/*,$client} by {namespace}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}]},"layout":{"x":0,"y":6,"width":6,"height":3}},{"id":5458102764854210,"definition":{"title":"Pulsar Local Audit Storage by Topic","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1 - query2"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:pulsar.storage_size{namespace:compliance/*,$client} by {topic}"},{"name":"query2","data_source":"metrics","query":"sum:pulsar.storage_offloaded_size{namespace:compliance/*,$client} by {topic}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}]},"layout":{"x":0,"y":9,"width":6,"height":3}},{"id":8868888990764298,"definition":{"title":"30-Day Log Usage ($/day)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"type":"live","unit":"week","value":4},"type":"timeseries","requests":[{"formulas":[{"alias":"ingestion ($)","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}},"formula":"query1 / 1024 / 1024 / 1024 * 0.1 * 4"},{"alias":"indexing ($)","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}},"formula":"query2 / 1000000 * 1.2 * 4"},{"alias":"metrics ($)","formula":"cutoff_min((query3 - 4000) / 100 * 5 / 30, 0)"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.estimated_usage.logs.ingested_bytes{*}.rollup(sum, 21600)"},{"data_source":"metrics","name":"query2","query":"sum:datadog.estimated_usage.logs.ingested_events{datadog_is_excluded:false}.as_count().rollup(sum, 21600)"},{"data_source":"metrics","name":"query3","query":"sum:datadog.estimated_usage.metrics.custom{*}.rollup(max, 21600)"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"area"}]},"layout":{"x":6,"y":9,"width":6,"height":3}},{"id":1478450394211188,"definition":{"title":"Dead Letter Topic Backlogs","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"sum:pulsar.subscription_back_log{(subscription:*-DLT OR subscription:*-dlt) AND $client} by {topic,subscription}","aggregator":"last"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","formula":"query1","conditional_formats":[{"comparator":">","value":10,"palette":"white_on_red"}]}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":12,"width":6,"height":3}},{"id":1535180438180276,"definition":{"title":"Location Updates","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"max:saviadb.pdr.model_count{record_key:locationmodel,$client} by {kube_namesapce}","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"max:saviadb.pdr.newest_age_days{record_key:locationmodel,$client} by {kube_namesapce}","aggregator":"avg"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"number","alias":"Count","formula":"query1"},{"cell_display_mode":"number","number_format":{"unit":{"type":"canonical_unit","unit_name":"day"}},"alias":"Age","formula":"query2"}]}],"has_search_bar":"never"},"layout":{"x":6,"y":12,"width":6,"height":3}},{"id":6723209104755490,"definition":{"title":"Model Counts","title_size":"16","title_align":"left","type":"split_group","source_widget_definition":{"title":"","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"max:saviadb.pdr.model_count{!record_key:locationmodel,$client} by {record_key}","aggregator":"max"}],"response_format":"scalar","conditional_formats":[{"comparator":"<","value":6000,"palette":"white_on_green"},{"comparator":">=","value":6000,"palette":"white_on_yellow"}],"formulas":[{"formula":"top(query1, 5, 'mean', 'desc')"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"split_config":{"split_dimensions":[{"one_graph_per":"kube_namesapce"}],"limit":12,"sort":{"order":"desc"}},"size":"sm","has_uniform_y_axes":true},"layout":{"x":0,"y":15,"width":12,"height":3,"is_column_break":true}}],"template_variables":[{"name":"client","prefix":"client","available_values":["ihc","lbh"],"default":"ihc"}],"layout_type":"ordered","notify_list":["steve.carlson@saviahealth.com"],"reflow_type":"fixed","tags":["team:platform-infrastructure-team"]}