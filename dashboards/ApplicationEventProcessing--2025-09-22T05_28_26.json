{"title":"Application Event Processing","description":"","widgets":[{"id":2188088497165572,"definition":{"title":"Platform Service Requests","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"formulas":[{"alias":"Backlog","formula":"query3"}],"queries":[{"name":"query3","data_source":"metrics","query":"sum:pulsar.subscription_back_log{namespace:clinical-apps/$namespace.value,topic:*/platform-service-requests , subscription:clinical-apps/*}.rollup(max, 60)"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":false,"formulas":[{"alias":"Messages In / min","style":{"palette":"classic","palette_index":3},"formula":"per_second(query6)"}],"queries":[{"name":"query6","data_source":"metrics","query":"sum:pulsar.in_messages_total{namespace:clinical-apps/$namespace.value,topic:*/platform-service-requests}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":0,"width":6,"height":2}},{"id":4438634662356355,"definition":{"title":"QIE Backlog","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"a"}],"queries":[{"name":"a","data_source":"logs","search":{"query":"service:qie \"message processed\" kube_namespace:integration"},"indexes":["*"],"group_by":[{"facet":"@channelName","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":60000},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic"},"display_type":"bars"},{"formulas":[{"formula":"query0"}],"queries":[{"data_source":"metrics","name":"query0","query":"sum:qie.channel.inbound{environment:prd,!channel.name:ihc-ill-csv} by {channel.name}.rollup(sum, 60)"}],"response_format":"timeseries","on_right_yaxis":true,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":0,"width":6,"height":2}},{"id":7599152798651818,"definition":{"title":"FHIR Ingress Backlog","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"formulas":[{"alias":"Backlog","formula":"query3"},{"alias":"Backlog","formula":"query1"}],"queries":[{"name":"query3","data_source":"metrics","query":"sum:pulsar.subscription_back_log{(namespace:clinical-apps/$namespace.value AND ((topic:*fhir-ingress* OR topic:*fhir.ingress-event*) AND NOT topic:*DLT AND NOT topic:*dlt AND NOT subscription:*reader*)) OR (subscription:clinical-apps/$namespace.value/pipeline-fhir-ingress-events-consumer)} by {topic}.rollup(max, 60)"},{"name":"query1","data_source":"metrics","query":"sum:kafka_consumergroup_lag_sum{kube_namespace:$namespace.value,topic:abd-fhir-ingress}.rollup(max, 60)"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":false,"formulas":[{"alias":"Msg Rate","style":{"palette":"cool","palette_index":5},"formula":"per_second(query6)"}],"queries":[{"name":"query6","data_source":"metrics","query":"sum:pulsar.in_messages_total{namespace:clinical-apps/$namespace.value,topic:*/abd-fhir-ingress*}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":2,"width":5,"height":2}},{"id":598187888990288,"definition":{"title":"FHIR Ingress Pipline (events/minute)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Received / min","formula":"max(default_zero(query1), default_zero(query2))"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:savia.event.processed{kube_namespace:$namespace.value AND (pod_name:*-abd-pipeline-fhir* OR pod_name:*fhir-integration* OR topic:*fhir*)} by {pod_name}.as_count().rollup(sum, 60)"},{"name":"query2","data_source":"logs","search":{"query":"kube_namespace:$namespace.value pod_name:*pipeline* \"received\" @topic:*fhir-ingress*"},"indexes":["*"],"group_by":[{"facet":"pod_name","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":60000},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"semantic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":5,"y":2,"width":5,"height":2}},{"id":899775718741403,"definition":{"title":"Top FhirIngress Keys","title_size":"16","title_align":"left","time":{"type":"live","unit":"minute","value":3},"requests":[{"queries":[{"name":"a","data_source":"logs","search":{"query":"kube_namespace:$namespace.value (pod_name:*pipeline-fhir* OR service:fhir-integration-service OR (container_name:abd-pipeline @topic:*fhir-ingress*)) \"Received\""},"indexes":["*"],"group_by":[{"facet":"@messageKey","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","style":{"palette":"datadog16"},"formulas":[{"formula":"a"}],"sort":{"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"type":"sunburst","legend":{"type":"automatic"}},"layout":{"x":10,"y":2,"width":2,"height":2}},{"id":614917940607992,"definition":{"title":"Model Persisted Backlog","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"formulas":[{"alias":"Backlog","style":{"palette":"orange"},"formula":"query3"},{"alias":"Backlog","formula":"query1"}],"queries":[{"name":"query3","data_source":"metrics","query":"sum:pulsar.subscription_back_log{namespace:clinical-apps/$namespace.value AND (subscription:*stateless-workflow-integration-service OR subscription:*analytics-index-agent OR subscription:*model-persisted-events-consumer)} by {subscription}.rollup(max, 60)"},{"name":"query1","data_source":"metrics","query":"sum:kafka_consumergroup_lag_sum{kube_namespace:$namespace.value,topic:abd_db.art.model_persisted_event_journal} by {consumergroup}.rollup(sum, 60)"}],"response_format":"timeseries","style":{"palette":"grey","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":false,"formulas":[{"alias":"Msg Rate","style":{"palette":"orange","palette_index":6},"formula":"per_second(query6)"}],"queries":[{"name":"query6","data_source":"metrics","query":"sum:pulsar.in_messages_total{namespace:clinical-apps/$namespace.value,topic:*/*model_persisted_event_journal}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":4,"width":5,"height":2}},{"id":4874075882043114,"definition":{"title":"Model Persisted Pipline (events/minute)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Received / min","formula":"max(default_zero(query1), default_zero(query2))"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:savia.event.received{kube_namespace:$namespace.value AND (pod_name:*-abd-pipeline-model* OR container_name:stateless-workflow-integration-service)} by {pod_name}.as_count().rollup(sum, 60)"},{"name":"query2","data_source":"logs","search":{"query":"kube_namespace:$namespace.value pod_name:*pipeline* \"received\" @topic:*model_persisted*"},"indexes":["*"],"group_by":[{"facet":"pod_name","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":60000},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"semantic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":5,"y":4,"width":5,"height":2}},{"id":2678082761564846,"definition":{"title":"Top ModelPersisted Keys","title_size":"16","title_align":"left","time":{"type":"live","unit":"minute","value":3},"requests":[{"queries":[{"name":"a","data_source":"logs","search":{"query":"kube_namespace:$namespace.value (pod_name:*model-persisted* OR service:stateless-workflow-integration-service OR (container_name:abd-pipeline @topic:*model_persisted*)) \"Received\""},"indexes":["*"],"group_by":[{"facet":"@messageKey","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","style":{"palette":"datadog16"},"formulas":[{"formula":"a"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"type":"sunburst","legend":{"type":"automatic"}},"layout":{"x":10,"y":4,"width":2,"height":2}},{"id":100267352463774,"definition":{"title":"External Workflow Backlog","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"formulas":[{"alias":"Backlog","formula":"query3"},{"alias":"Backlog","style":{"palette":"cool","palette_index":0},"formula":"query1"}],"queries":[{"name":"query3","data_source":"metrics","query":"sum:pulsar.subscription_back_log{namespace:clinical-apps/$namespace.value AND (subscription:*task-execution-endpoint-invoker-service OR subscription:*task-execution-plan-requested)} by {subscription,topic}.rollup(max, 60)"},{"name":"query1","data_source":"metrics","query":"sum:kafka_consumergroup_lag_sum{kube_namespace:$namespace.value,topic:external-workflow-task-triggered}.rollup(max, 60)"}],"response_format":"timeseries","style":{"palette":"grey","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":false,"formulas":[{"alias":"Msg Rate","style":{"palette":"green","palette_index":5},"formula":"per_minute(query6)"}],"queries":[{"name":"query6","data_source":"metrics","query":"sum:pulsar.in_messages_total{namespace:clinical-apps/$namespace.value,topic:*external-workflow-task-triggered*}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":6,"width":5,"height":2}},{"id":505268454139562,"definition":{"title":"External Workflow Pipline (events/minute)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"max(default_zero(query3), max(default_zero(query1), default_zero(query2)))"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:savia.event.processed{kube_namespace:$namespace.value,pod_name:*-abd-pipeline-ext-wf*} by {pod_name}.as_count().rollup(sum, 60)"},{"data_source":"metrics","name":"query2","query":"sum:savia.event.processed{kube_namespace:$namespace.value,container_name:workflow-task-execution-endpoint-invoker-service} by {pod_name}.as_count().rollup(sum, 60)"},{"name":"query3","data_source":"logs","search":{"query":"kube_namespace:$namespace.value pod_name:*pipeline* \"received\" @topic:*external-workflow*"},"indexes":["*"],"group_by":[{"facet":"pod_name","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count","interval":60000},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"semantic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":5,"y":6,"width":5,"height":2}},{"id":2984063366054962,"definition":{"title":"Top ExtWorkflow Keys","title_size":"16","title_align":"left","time":{"type":"live","unit":"minute","value":3},"requests":[{"queries":[{"name":"a","data_source":"logs","search":{"query":"kube_namespace:$namespace.value (pod_name:*pipeline-ext-wf* OR service:workflow-task-execution-endpoint-invoker-service OR (container_name:abd-pipeline @topic:*external*)) \"Received\""},"indexes":["*"],"group_by":[{"facet":"@messageKey","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","style":{"palette":"datadog16"},"formulas":[{"formula":"a"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"type":"sunburst","legend":{"type":"automatic"}},"layout":{"x":10,"y":6,"width":2,"height":2}},{"id":6088940415014404,"definition":{"title":"Database CPU by Instance","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:azure.dbforpostgresql_flexibleservers.cpu_percent{*} by {database_instance}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":8,"width":6,"height":4}},{"id":8673607784884680,"definition":{"title":"Pulsar/Kafka Backlogs, All Subscriptions/Topics","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"subscription","formula":"query1"},{"alias":"subscription","formula":"query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:pulsar.subscription_back_log{namespace:clinical-apps/$namespace.value,!subscription:__*,!subscription:*Reader*,!subscription:*reader*,!subscription:*_compaction*,!subscription:*-dlt} by {subscription}"},{"data_source":"metrics","name":"query2","query":"sum:kafka_consumergroup_lag_sum{kube_namespace:$namespace.value,!topic:_*} by {topic}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":8,"width":6,"height":4}},{"id":5324051733456786,"definition":{"title":"Events Received per second, All Containers","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1 / 60"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:savia.event.received{kube_namespace:$namespace.value} by {service}.as_count().rollup(sum, 60)"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":12,"width":12,"height":3}}],"template_variables":[{"name":"namespace","prefix":"kube_namespace","available_values":[],"default":"*"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed","tags":["team:platform-infrastructure-team"]}